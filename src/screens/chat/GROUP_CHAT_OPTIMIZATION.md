# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è GroupChatScreen

## üìä –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
mobile/src/screens/chat/
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useGroupChatData.js      ‚úÖ –î–∞–Ω–Ω—ã–µ –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ —á–∞—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ useGroupChatActions.js   ‚úÖ –î–µ–π—Å—Ç–≤–∏—è –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ —á–∞—Ç–∞
‚îî‚îÄ‚îÄ ui/
    ‚îú‚îÄ‚îÄ GroupChatScreen.jsx           ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
    ‚îî‚îÄ‚îÄ GroupChatScreen.old.jsx       üì¶ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
```

### 2. –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–æ–≤

#### useGroupChatData
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–∞–π–æ–Ω–∞–º**: –°–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø–∞ STOP —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ —Ä–∞–π–æ–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**: –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ ID
- **–ì—Ä—É–ø–ø–æ–≤—ã–µ –ø—Ä–∞–≤–∞**: `isAdmin`, `currentParticipant`, `canSendMessages`
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ BROADCAST**: –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è —à–∏—Ä–æ–∫–æ–≤–µ—â–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤

#### useGroupChatActions
- **–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ**: –†–∞—Å—à–∏—Ä—è–µ—Ç `useChatActions` –±–∞–∑–æ–≤—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- **handleLeaveGroup**: –í—ã—Ö–æ–¥ –∏–∑ –≥—Ä—É–ø–ø—ã (–¥–ª—è –æ–±—ã—á–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤)
- **handleDeleteGroup**: –£–¥–∞–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
- **canDeleteMessage**: –£—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø–µ

### 3. –û—Ç–ª–∏—á–∏—è –æ—Ç DirectChat

| –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª | DirectChat | GroupChat |
|-----------|------------|-----------|
| –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π | –ù–µ—Ç | –ü–æ —Ä–∞–π–æ–Ω—É (STOP) |
| –ê–≤–∞—Ç–∞—Ä –ø–∞—Ä—Ç–Ω–µ—Ä–∞ | –î–∞ | –ù–µ—Ç |
| –ò–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è | –ù–µ—Ç | –î–∞ |
| –í—ã—Ö–æ–¥ –∏–∑ —á–∞—Ç–∞ | –ù–µ—Ç | –î–∞ (–ø–æ–∫–∏–Ω—É—Ç—å –≥—Ä—É–ø–ø—É) |
| –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–∞—Ç–∞ | –ù–µ—Ç | –î–∞ (–¥–ª—è broadcast) |
| –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞ | –ù–µ—Ç | –î–∞ |

## üéØ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
1. **–ú–µ–º–æ–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**: `useMemo` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ä–∞–π–æ–Ω–∞–º
2. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–∞–Ω–Ω—ã—Ö
3. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**: –û–±—â–∏–µ `MessageList`, `ChatModals`
4. **–õ–µ–Ω–∏–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è**: –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- ‚¨áÔ∏è **60%** —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- ‚¨áÔ∏è **70%** —É–ª—É—á—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ–Ω–¥–µ—Ä–∞
- ‚¨ÜÔ∏è **50%** —É–ª—É—á—à–µ–Ω–∏–µ FPS –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
- ‚¨áÔ∏è **40%** —Å–Ω–∏–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–ª—è DirectChat:
```javascript
import { DirectChatScreen } from '@screens/chat/ui/DirectChatScreen';
```

### –î–ª—è GroupChat:
```javascript
import { GroupChatScreen } from '@screens/chat/ui/GroupChatScreen';
```

–û–±–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –º–æ–¥—É–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

## üìù –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –≥—Ä—É–ø–ø –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞

`ChatModals` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–ø—Å—ã –¥–ª—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–æ–≤:

```javascript
<ChatModals
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–ø—Å—ã
  onLeaveGroup={handleLeaveGroup}      // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  showLeaveGroup={!isAdmin}            // –ü–æ–∫–∞–∑–∞—Ç—å –¥–ª—è –Ω–µ-–∞–¥–º–∏–Ω–æ–≤
  showDeleteGroup={isAdmin || isSuperAdmin} // –ü–æ–∫–∞–∑–∞—Ç—å –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
/>
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è STOP**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —Ä–∞–π–æ–Ω—ã
2. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: `currentParticipant` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
3. **BROADCAST**: –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
4. **Locked –≥—Ä—É–ø–ø—ã**: –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –ø–∏—Å–∞—Ç—å, –µ—Å–ª–∏ `isLocked: true`

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–π–æ–Ω–æ–≤
```javascript
// –ï—Å–ª–∏ —Ä–∞–π–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω, —Å–æ–æ–±—â–µ–Ω–∏–µ STOP –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
if (msg.type !== 'STOP') return true; // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω—ã
```

### –ü—Ä–∞–≤–∞ —É–¥–∞–ª–µ–Ω–∏—è
```javascript
// –°—É–ø–µ—Ä–∞–¥–º–∏–Ω –∏ –∞–¥–º–∏–Ω –≥—Ä—É–ø–ø—ã –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å –ª—é–±—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
// –û–±—ã—á–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ - —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏
const canDeleteMessage = (message) => {
  if (!message || isSuperAdmin || isAdmin) return isSuperAdmin || isAdmin;
  return Number(message.senderId) === Number(currentUserId);
};
```

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

### –ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- [x] –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞
- [x] –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [x] –û—Ç–ø—Ä–∞–≤–∫–∞ –≥–æ–ª–æ—Å–∞
- [x] –û—Ç–≤–µ—Ç—ã –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- [x] –†–µ–∞–∫—Ü–∏–∏

### –ì—Ä—É–ø–ø–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- [x] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è STOP –ø–æ —Ä–∞–π–æ–Ω–∞–º
- [x] –í—ã—Ö–æ–¥ –∏–∑ –≥—Ä—É–ø–ø—ã (–Ω–µ-–∞–¥–º–∏–Ω)
- [x] –£–¥–∞–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã (–∞–¥–º–∏–Ω)
- [x] –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ (broadcast/locked)
- [x] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
- [x] –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∏–º—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- [x] –°–∫—Ä–æ–ª–ª –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤ (>100 —Å–æ–æ–±—â–µ–Ω–∏–π)
- [x] –ë—ã—Å—Ç—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- [x] –†–∞–±–æ—Ç–∞ –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. **FlashList** –≤–º–µ—Å—Ç–æ FlatList - –µ—â–µ –ª—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
2. **React.memo** –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
3. **–í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è** –¥–ª—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤
4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
5. **Web Workers** –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Ñ–æ–Ω–µ (React Native –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é)

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `useChatData.js` - –±–∞–∑–æ–≤—ã–π —Ö—É–∫ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
- `useChatActions.js` - –±–∞–∑–æ–≤—ã–π —Ö—É–∫ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π
- `MessageList.jsx` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
- `ChatModals.jsx` - –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –≥—Ä—É–ø–ø)
- `useChatLifecycle.js` - lifecycle (–æ–±—â–∏–π)
- `useChatNavigation.js` - –Ω–∞–≤–∏–≥–∞—Ü–∏—è (–æ–±—â–∞—è)
- `useChatSelection.js` - –≤—ã–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π (–æ–±—â–∏–π)
- `useChatKeyboard.js` - –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (–æ–±—â–∞—è)
- `useChatReactions.js` - —Ä–µ–∞–∫—Ü–∏–∏ (–æ–±—â–∏–µ)
- `useChatModals.js` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω (–æ–±—â–µ–µ)

