# Исправление отображения кнопок возвратов на экране поставщика

## Проблема

На экране поставщика (`SupplierContent`) все пользователи (включая клиентов) видели кнопки:
- **"Залежавшиеся товары"** - товары без продаж более 3 недель
- **"Мои возвраты"** - статус и история возвратов

Эти кнопки должны быть доступны **только для поставщиков**, так как:
1. Только поставщики могут управлять своими товарами
2. Только поставщики могут просматривать статус возвратов своих товаров
3. Клиентам эти функции не нужны и могут вызвать путаницу

## Решение

Добавлена проверка роли пользователя перед отображением карточек возвратов.

### Изменения в `mobile/src/screens/supplier/ui/SupplierContent.jsx`

#### 1. Добавлены импорты для проверки роли

```javascript
import { useDispatch, useSelector } from 'react-redux';
import { selectUser } from '@entities/auth';
```

#### 2. Добавлена проверка роли пользователя

```javascript
// Получаем текущего пользователя для проверки роли
const currentUser = useSelector(selectUser);
const isSupplier = useMemo(() => currentUser?.role === 'SUPPLIER', [currentUser?.role]);
```

#### 3. Условное отображение карточек

```javascript
{isSupplier && renderReturnCards()}
{renderProducts()}
{renderFeedbacks()}
```

## Технические детали

### Логика проверки роли

```javascript
const isSupplier = useMemo(() => currentUser?.role === 'SUPPLIER', [currentUser?.role]);
```

- Используется `useMemo` для оптимизации - значение пересчитывается только при изменении роли
- Проверяется строгое равенство `role === 'SUPPLIER'`
- Safe navigation operator (`?.`) защищает от ошибок если пользователь не загружен

### Возможные роли пользователей

- `CLIENT` - обычные клиенты (не видят карточки)
- `SUPPLIER` - поставщики (видят карточки)
- `EMPLOYEE` - сотрудники (не видят карточки)
- `DRIVER` - водители (не видят карточки)
- `ADMIN` - администраторы (не видят карточки)

## Функциональность карточек (только для поставщиков)

### 1. Залежавшиеся товары
- **Навигация**: `StagnantProducts`
- **Цель**: Показать товары, которые не продавались более 3 недель
- **UI**: Оранжевая карточка с иконкой ⚠️

### 2. Мои возвраты
- **Навигация**: `ProductReturns`
- **Цель**: Показать историю и статус возвратов товаров поставщика
- **UI**: Фиолетовая карточка с иконкой 📦

## Визуальное представление

### До исправления ❌
```
┌─────────────────────────────────────┐
│ Экран поставщика (ДЛЯ ВСЕХ)         │
├─────────────────────────────────────┤
│ [Заголовок поставщика]              │
│                                     │
│ ┌────────────┐  ┌────────────┐     │
│ │ ⚠️ Залеж.  │  │ 📦 Возврат │  ← Видят ВСЕ
│ │  товары    │  │    ы       │     │
│ └────────────┘  └────────────┘     │
│                                     │
│ [Товары поставщика]                 │
│ [Отзывы]                            │
└─────────────────────────────────────┘
```

### После исправления ✅
```
┌─────────────────────────────────────┐
│ Экран поставщика (КЛИЕНТ)           │
├─────────────────────────────────────┤
│ [Заголовок поставщика]              │
│                                     │
│ [Товары поставщика]                 │ ← Карточек нет
│ [Отзывы]                            │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ Экран поставщика (ПОСТАВЩИК)        │
├─────────────────────────────────────┤
│ [Заголовок поставщика]              │
│                                     │
│ ┌────────────┐  ┌────────────┐     │
│ │ ⚠️ Залеж.  │  │ 📦 Возврат │  ← Только для
│ │  товары    │  │    ы       │     поставщиков
│ └────────────┘  └────────────┘     │
│                                     │
│ [Товары поставщика]                 │
│ [Отзывы]                            │
└─────────────────────────────────────┘
```

## Тестирование

### Сценарий 1: Клиент просматривает поставщика
1. Войти как клиент (`CLIENT`)
2. Перейти на экран любого поставщика
3. **Ожидаемый результат**: Карточки "Залежавшиеся товары" и "Мои возвраты" НЕ отображаются
4. Отображаются только: заголовок поставщика, товары, отзывы

### Сценарий 2: Поставщик просматривает свой экран
1. Войти как поставщик (`SUPPLIER`)
2. Перейти на свой экран поставщика
3. **Ожидаемый результат**: Карточки "Залежавшиеся товары" и "Мои возвраты" отображаются
4. При нажатии на карточки происходит навигация на соответствующие экраны

### Сценарий 3: Другие роли
1. Войти как администратор/сотрудник/водитель
2. Перейти на экран поставщика
3. **Ожидаемый результат**: Карточки НЕ отображаются

## Влияние на производительность

- ✅ Минимальное - добавлен только один `useSelector` и один `useMemo`
- ✅ `useMemo` предотвращает ненужные перерасчеты
- ✅ Условный рендеринг не влияет на производительность

## Безопасность

- ✅ Проверка роли происходит на клиенте (UI level)
- ⚠️ **Важно**: Серверные эндпоинты `StagnantProducts` и `ProductReturns` должны также проверять роль пользователя
- ✅ Даже если клиент попытается напрямую открыть эти экраны, сервер должен отклонить запрос

## Связанные файлы

- `mobile/src/screens/supplier/ui/SupplierContent.jsx` - основной компонент
- `mobile/src/entities/auth/model/selectors.js` - селектор `selectUser`
- `mobile/src/screens/supplier/ui/StagnantProductsScreen.jsx` - экран залежавшихся товаров
- `mobile/src/screens/supplier/ui/ProductReturnsScreen.jsx` - экран возвратов

## Дата исправления
29 октября 2025

## Автор
Исправление выполнено на основе фидбека о некорректном отображении UI элементов для разных ролей пользователей.

