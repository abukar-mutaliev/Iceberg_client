# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –ü—Ä–æ–±–ª–µ–º–∞
Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∏ –≤ Expo Go, –Ω–∏ –≤ preview builds.

## –†–µ—à–µ–Ω–∏–µ

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ EXPO_ACCESS_TOKEN

#### –®–∞–≥ 1: –í–æ–π–¥–∏—Ç–µ –≤ Expo
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://expo.dev
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç

#### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç–µ Access Token
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Account Settings**
2. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª **"Access Tokens"** –∏–ª–∏ **"API Keys"**
3. –ù–∞–∂–º–∏—Ç–µ **"Create Token"** –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω (–æ–Ω –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `ExpoToken`)

#### –®–∞–≥ 3: –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ —Å–µ—Ä–≤–µ—Ä
1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –ø–∞–ø–∫–µ `server/`
2. –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:
   ```
   EXPO_ACCESS_TOKEN=your-expo-access-token-here
   ```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
cd server
node check-expo-token.js
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–¥–µ

#### 3.1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ PushNotificationService

–ü—Ä–æ–±–ª–µ–º–∞: –í Expo Go –∏ preview builds –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –ø–æ–ª—É—á–µ–Ω–∏—è projectId.

**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ `mobile/src/shared/services/PushNotificationService.js`:

```javascript
getProjectId() {
    try {
        const isExpoGo = Constants?.executionEnvironment === 'expo' || Constants?.appOwnership === 'expo';
        
        if (isExpoGo || __DEV__) {
            return "934456aa-74ef-4c35-844b-aa0c0c2899f3"; // –í–∞—à projectId
        }
        
        // –î–ª—è standalone builds
        return Constants?.expoConfig?.extra?.eas?.projectId || 
               Constants?.manifest2?.extra?.eas?.projectId ||
               "934456aa-74ef-4c35-844b-aa0c0c2899f3";
    } catch (error) {
        return "934456aa-74ef-4c35-844b-aa0c0c2899f3";
    }
}
```

#### 3.2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤

–ü—Ä–æ–±–ª–µ–º–∞: –í Expo Go —Ç–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø–æ-–¥—Ä—É–≥–æ–º—É.

**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ `registerForPushNotificationsAsync`:

```javascript
// –î–ª—è Expo Go –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –Ω—É–∂–µ–Ω projectId
if (isExpoGo || __DEV__) {
    const tokenResult = await Notifications.getExpoPushTokenAsync({ 
        projectId: projectId 
    });
    token = tokenResult.data;
}
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 4.1. –í Expo Go
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Expo Go
2. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç
3. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
4. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è"
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å

#### 4.2. –í Preview Build
1. –°–æ–±–µ—Ä–∏—Ç–µ preview build:
   ```bash
   cd mobile
   eas build --profile preview --platform android
   ```
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ APK –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### 5. –û—Ç–ª–∞–¥–∫–∞

#### 5.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞
–í–∫–ª—é—á–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:
```javascript
console.log('üîç Build type check:', { isStandalone, isExpoGo, __DEV__ });
console.log('üé´ Expo push token obtained:', token?.substring(0, 50) + '...');
```

#### 5.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞
```bash
tail -f server/logs/app.log | grep "push"
```

#### 5.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –±–∞–∑–µ
```sql
SELECT 
    u.email,
    u.role,
    pt.token,
    pt.platform,
    pt.isActive,
    pt.createdAt
FROM "UserPushToken" pt
JOIN "User" u ON pt.userId = u.id
WHERE pt.isActive = true
ORDER BY pt.createdAt DESC;
```

### 6. –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 6.1. "EXPO_ACCESS_TOKEN is required"
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ `.env` —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞

#### 6.2. "Invalid push token"
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å projectId –≤ –∫–æ–¥–µ

#### 6.3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Expo Go
**–†–µ—à–µ–Ω–∏–µ**: 
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π projectId
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ permissions –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

#### 6.4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ preview build
**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–±–æ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π projectId
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ EXPO_ACCESS_TOKEN –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

#### 7.1. –¢–µ—Å—Ç–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
```bash
# –ß–µ—Ä–µ–∑ API
curl -X POST http://212.67.11.134:5000/api/push-tokens/test-public \
  -H "Content-Type: application/json" \
  -d '{
    "token": "ExponentPushToken[your-token-here]",
    "title": "–¢–µ—Å—Ç",
    "body": "–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"
  }'
```

#### 7.2. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
1. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –∫–∞–∫ –≤–æ–¥–∏—Ç–µ–ª—å
2. –°–æ–∑–¥–∞–π—Ç–µ –æ—Å—Ç–∞–Ω–æ–≤–∫—É –≤ —Ä–∞–π–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –ø—Ä–∏—Ö–æ–¥–∏—Ç –ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É

### 8. –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è:
1. –°–æ–±–µ—Ä–∏—Ç–µ –ª–æ–≥–∏ –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å Expo services
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ EXPO_ACCESS_TOKEN –∞–∫—Ç—É–∞–ª—å–Ω—ã–π 